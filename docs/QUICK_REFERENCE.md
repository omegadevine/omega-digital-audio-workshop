# Quick Reference: Omega DAW Build System

## Common Commands

### First Time Setup
```powershell
# Clone repository
git clone https://github.com/omegadevine/omega-digital-audio-workshop.git
cd omega-digital-audio-workshop

# Setup dependencies (one-time)
.\scripts\setup_dependencies.ps1

# Build
.\scripts\build.ps1

# Run
.\build\bin\OmegaDAW.exe
```

### Daily Development
```powershell
# Normal build (incremental)
.\scripts\build.ps1

# Clean build
.\scripts\build.ps1 -Clean

# Release build
.\scripts\build.ps1 -Release
```

### Troubleshooting
```powershell
# "Procedure entry point" errors
.\scripts\setup_dependencies.ps1 -Force -Clean
.\scripts\build.ps1 -Clean

# Missing DLL errors
.\scripts\setup_dependencies.ps1 -Force

# Complete reset (nuclear option)
.\scripts\setup_dependencies.ps1 -Clean -Force
.\scripts\build.ps1 -Clean
```

## File Structure

```
omega-digital-audio-workshop/
├── scripts/
│   ├── setup_dependencies.ps1   # Dependency installer
│   └── build.ps1                # Build script
├── .deps_installed_1.0.0        # Dependency marker (DO NOT DELETE)
├── cmake_toolchain.cmake        # CMake configuration
├── build/                       # Build output
│   └── bin/
│       └── OmegaDAW.exe        # Executable
├── CMakeLists.txt              # CMake project file
└── src/                        # Source code
```

## Important Files

- **`.deps_installed_1.0.0`**: Marker indicating dependencies are installed
  - DO NOT DELETE unless you want to reinstall everything
  
- **`cmake_toolchain.cmake`**: CMake toolchain configuration
  - Generated by setup script
  - Contains compiler and library paths
  - Ensures consistent builds

## Dependency Location

Dependencies are installed in: `C:\msys64\mingw64\`

- **Libraries**: `C:\msys64\mingw64\lib\`
- **Headers**: `C:\msys64\mingw64\include\`
- **Compiler**: `C:\msys64\mingw64\bin\gcc.exe`

This location is:
- Outside project directory
- Persistent across builds
- Shared with other MSYS2 projects

## Build Script Options

### setup_dependencies.ps1
```powershell
.\scripts\setup_dependencies.ps1 [options]

Options:
  -Force   # Reinstall dependencies even if already installed
  -Clean   # Remove all build directories before setup
```

### build.ps1
```powershell
.\scripts\build.ps1 [options]

Options:
  -Clean      # Clean build directory before building
  -Release    # Build in Release mode (default: Debug)
  -SkipDeps   # Skip dependency check (NOT RECOMMENDED)
```

## Status Indicators

- ✓ **Green checkmark**: Success
- ✗ **Red X**: Failure
- **Yellow text**: Warning or information

## When to Run What

| Situation | Command |
|-----------|---------|
| First clone | `setup_dependencies.ps1` then `build.ps1` |
| Daily coding | `build.ps1` |
| After git pull | `build.ps1` |
| New dependency added | `setup_dependencies.ps1 -Force` |
| "Entry point" error | `setup_dependencies.ps1 -Force -Clean` then `build.ps1 -Clean` |
| Missing DLL | `setup_dependencies.ps1 -Force` |
| Clean slate | `setup_dependencies.ps1 -Clean -Force` then `build.ps1 -Clean` |
| CI/CD first run | `setup_dependencies.ps1` |
| CI/CD subsequent | `build.ps1 -SkipDeps` (if deps cached) |

## Environment Requirements

### Required Software
- **MSYS2**: https://www.msys2.org/
- **CMake**: Included with MSYS2
- **Git**: For cloning repository

### MSYS2 Packages (auto-installed)
- `mingw-w64-x86_64-gcc`
- `mingw-w64-x86_64-SDL2`
- `mingw-w64-x86_64-SDL2_ttf`
- `mingw-w64-x86_64-portaudio`
- `mingw-w64-x86_64-cmake`

## Tips

1. **Don't delete `.deps_installed_*` files** - they prevent redundant installations
2. **Use the scripts** - they include safety checks and proper PATH setup
3. **Check output** - scripts provide detailed status information
4. **Save logs** - if something fails: `.\scripts\build.ps1 2>&1 | Tee-Object build.log`
5. **Clean builds** - use `-Clean` flag if weird errors occur

## Getting Help

- **Build System**: See [DEPENDENCY_MANAGEMENT.md](../DEPENDENCY_MANAGEMENT.md)
- **Security**: See [docs/BUILD_SECURITY.md](../docs/BUILD_SECURITY.md)
- **Project**: See [README.md](../README.md)
- **Issues**: https://github.com/omegadevine/omega-digital-audio-workshop/issues
